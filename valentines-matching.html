<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Valentine's Matching — Memory Game</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,600;1,400&display=swap');

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      min-height: 100vh;
      background: radial-gradient(ellipse at center, #1a0a0f 0%, #0d0308 50%, #050204 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-family: 'Cormorant Garamond', serif;
      color: rgba(255, 220, 230, 0.95);
      padding: 1.5rem;
    }

    .back-link {
      position: fixed;
      top: 1rem;
      left: 1rem;
      z-index: 10;
      color: rgba(255, 200, 220, 0.9);
      text-decoration: none;
      font-size: 1rem;
      font-weight: 600;
    }
    .back-link:hover { text-decoration: underline; }

    h1 {
      font-size: 1.75rem;
      font-weight: 600;
      letter-spacing: 0.06em;
      margin-bottom: 0.5rem;
      text-shadow: 0 0 20px rgba(255, 100, 130, 0.4);
    }

    .sub {
      font-size: 1rem;
      opacity: 0.85;
      margin-bottom: 1rem;
    }

    .timer {
      font-size: 1.25rem;
      margin-bottom: 1rem;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 0.5rem;
      max-width: 320px;
      margin: 0 auto 1.5rem;
    }

    .card {
      aspect-ratio: 1;
      background: linear-gradient(145deg, rgba(80, 20, 40, 0.9), rgba(40, 10, 25, 0.95));
      border: 2px solid rgba(255, 120, 150, 0.4);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
    .card:hover:not(.flipped):not(.matched) {
      transform: scale(1.03);
      box-shadow: 0 0 20px rgba(255, 80, 120, 0.4);
    }
    .card.flipped,
    .card.matched {
      cursor: default;
      border-color: rgba(255, 180, 200, 0.6);
      background: linear-gradient(145deg, rgba(120, 40, 60, 0.95), rgba(60, 20, 35, 0.98));
    }
    .card.matched {
      border-color: rgba(255, 200, 100, 0.5);
      box-shadow: 0 0 16px rgba(255, 180, 120, 0.3);
    }
    .card .back {
      color: rgba(255, 180, 200, 0.6);
      font-size: 1.5rem;
    }
    .card .icon-wrap {
      width: 56px;
      height: 56px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .card .icon-wrap svg {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    .result-overlay {
      position: fixed;
      inset: 0;
      background: rgba(10, 5, 15, 0.9);
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 5;
      padding: 2rem;
    }
    .result-overlay.visible { display: flex; }
    .result-overlay h2 {
      font-size: 2rem;
      margin-bottom: 0.5rem;
      text-shadow: 0 0 24px rgba(255, 100, 130, 0.5);
    }
    .result-overlay .time {
      font-size: 1.5rem;
      margin-bottom: 1.5rem;
    }
    .leaderboard {
      text-align: left;
      max-width: 260px;
      margin-bottom: 1.5rem;
    }
    .leaderboard h3 {
      font-size: 1.1rem;
      margin-bottom: 0.5rem;
      opacity: 0.9;
    }
    .leaderboard ol {
      padding-left: 1.25rem;
      font-size: 1rem;
      opacity: 0.9;
    }
    .leaderboard li { margin-bottom: 0.25rem; }
    .buttons {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      justify-content: center;
    }
    .buttons button,
    .buttons a {
      padding: 0.6rem 1.2rem;
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.1rem;
      font-weight: 600;
      border-radius: 10px;
      cursor: pointer;
      text-decoration: none;
      border: none;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .btn-play {
      background: rgba(255, 100, 140, 0.4);
      color: rgba(255, 235, 245, 0.98);
      border: 1px solid rgba(255, 150, 180, 0.5);
    }
    .btn-play:hover {
      transform: scale(1.05);
      box-shadow: 0 0 20px rgba(255, 100, 140, 0.4);
    }
    .btn-back {
      background: rgba(80, 60, 100, 0.4);
      color: rgba(255, 235, 245, 0.98);
      border: 1px solid rgba(140, 100, 180, 0.4);
    }
    .btn-back:hover {
      transform: scale(1.05);
      box-shadow: 0 0 16px rgba(140, 100, 180, 0.3);
    }
  </style>
</head>
<body>
  <a href="index.html" class="back-link">← Back to game</a>

  <div class="game-wrap">
    <h1>Valentine's Matching</h1>
    <p class="sub">Find all the pairs. Click two cards to flip them.</p>
    <p class="timer" id="timer">Time: 0.0s</p>
    <div class="grid" id="grid"></div>
  </div>

  <div class="result-overlay" id="resultOverlay">
    <h2>You found all the pairs!</h2>
    <p class="time" id="resultTime"></p>
    <div class="leaderboard">
      <h3>Best times</h3>
      <ol id="leaderboardList"></ol>
    </div>
    <div class="buttons">
      <button type="button" class="btn-play" id="playAgainBtn">Play again</button>
      <a href="index.html" class="btn-back">Back to game</a>
    </div>
  </div>

  <script>
    (function() {
      var COOKIE_NAME = 'valentines_matching_leaderboard';
      var MAX_LEADERBOARD = 10;
      var ICON_IDS = ['heart', 'rose', 'letter', 'bow', 'ring', 'candle', 'champagne', 'cupid'];

      function getIconHTML(iconId, uniqueId) {
        var u = uniqueId;
        var svgs = {
          heart: '<div class="icon-wrap"><svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><defs><linearGradient id="' + u + 'h" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#ff6b8a"/><stop offset="100%" stop-color="#c9184a"/></linearGradient></defs><path fill="url(#' + u + 'h)" d="M32 54C32 54 4 36 4 20c0-10 8-16 16-16 6 0 12 4 16 10 4-6 10-10 16-10 8 0 16 6 16 16 0 16-28 34-28 34z"/><path fill="rgba(255,255,255,0.25)" d="M20 10c-4 0-8 3-10 8 4 4 10 12 22 24 12-12 18-20 22-24-2-5-6-8-10-8-4 0-8 3-10 7-2-4-6-7-10-7z"/></svg></div>',
          rose: '<div class="icon-wrap"><svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><defs><linearGradient id="' + u + 'r" x1="0%" y1="100%" x2="0%" y2="0%"><stop offset="0%" stop-color="#8b2942"/><stop offset="50%" stop-color="#c41e3a"/><stop offset="100%" stop-color="#e63950"/></linearGradient></defs><path fill="#2d5a27" d="M32 58l-4-4v-12c0-2 1-4 3-5 4-2 8-6 10-10 2 1 4 2 5 4l2 2v15l-4 4-4 4z"/><path fill="url(#' + u + 'r)" d="M32 38c-8-4-14-10-14-18 0-8 6-14 14-14s14 6 14 14c0 8-6 14-14 18z"/><path fill="#a63d4a" d="M32 24c-4 0-8 2-10 6-1-4-2-6-4-8-4-4-10-4-14 0-2 2-3 5-2 8 0 6 4 12 10 16 4-2 10-6 14-12-2-4-4-6-4-10z"/><path fill="rgba(255,255,255,0.2)" d="M32 28c2 0 4 1 6 3-1 4-4 8-6 10-2-2-5-6-6-10 2-2 4-3 6-3z"/></svg></div>',
          letter: '<div class="icon-wrap"><svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><path fill="#e8d5c4" d="M8 16h48v32H8z"/><path fill="#d4b896" d="M8 16l24 20 24-20v32H8z"/><path fill="#c9184a" d="M28 30c0-2 2-4 4-4s4 2 4 4-2 4-4 4-4-2-4-4z"/><path fill="#9a1642" d="M26 30l4 2 4-2 2 1-4 3-4-3z"/></svg></div>',
          bow: '<div class="icon-wrap"><svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><path fill="#c9184a" d="M18 22c-2 0-4 2-4 4s2 4 4 4 4-2 4-4-2-4-4-4zm28 0c-2 0-4 2-4 4s2 4 4 4 4-2 4-4-2-4-4-4z"/><path fill="#9a1642" d="M22 24c0 2 2 4 4 4 2 0 4-2 4-4 0-2-2-4-4-4s-4 2-4 4zm12 0c0 2 2 4 4 4 2 0 4-2 4-4 0-2-2-4-4-4s-4 2-4 4z"/><path fill="#ff8fa3" d="M32 20c-6 0-10 4-12 8l-2 12 4 2 2-10c1-3 3-4 6-4h4c3 0 5 1 6 4l2 10 4-2-2-12c-2-4-6-8-12-8z"/><path fill="#8b2942" d="M32 18l-4 12h8z"/></svg></div>',
          ring: '<div class="icon-wrap"><svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><defs><linearGradient id="' + u + 'g" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#ffd89c"/><stop offset="100%" stop-color="#c9a227"/></linearGradient></defs><circle cx="32" cy="32" r="18" fill="none" stroke="url(#' + u + 'g)" stroke-width="4"/><circle cx="32" cy="32" r="14" fill="none" stroke="#ffd89c" stroke-width="2" opacity="0.8"/><circle cx="28" cy="28" r="2" fill="rgba(255,255,255,0.6)"/></svg></div>',
          candle: '<div class="icon-wrap"><svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><path fill="#e8e0d8" d="M28 20h8v28h-8z"/><path fill="#ffd89c" d="M30 14h4v8h-4z"/><path fill="#ff9f1c" d="M31 8h2v8h-2z"/><path fill="#ff6b35" d="M31 6h2v4h-2z"/><ellipse cx="32" cy="6" rx="3" ry="1" fill="rgba(255,150,80,0.4)"/><path fill="#8b2942" d="M26 48h12v4H26z"/></svg></div>',
          champagne: '<div class="icon-wrap"><svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><path fill="rgba(255,255,255,0.9)" d="M24 16h16v32c0 2-1 4-3 5h-10c-2-1-3-3-3-5V16z"/><path fill="rgba(255,255,255,0.5)" d="M26 18h12v28H26z"/><path fill="#f4e4bc" d="M28 12h8l2-4h-12z"/><path fill="#2d1810" d="M22 52h20v4H22z"/><ellipse cx="32" cy="14" rx="8" ry="2" fill="rgba(255,255,255,0.3)"/></svg></div>',
          cupid: '<div class="icon-wrap"><svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><defs><linearGradient id="' + u + 'c" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#ff6b8a"/><stop offset="100%" stop-color="#c9184a"/></linearGradient></defs><path fill="url(#' + u + 'c)" d="M32 50c-12-8-20-20-20-32 0-8 6-14 14-14 4 0 8 2 10 5 2-3 6-5 10-5 8 0 14 6 14 14 0 12-8 24-20 32z"/><path fill="#f4a5b0" d="M28 14c-4 0-8 3-8 8 0 6 6 12 12 18 6-6 12-12 12-18 0-5-4-8-8-8-2 0-4 1-6 2-2-1-4-2-6-2z"/><path fill="#1a1a2e" stroke="#2d2d44" stroke-width="1" d="M32 8l-2 12h4z"/><path fill="none" stroke="#8b7355" stroke-width="3" d="M32 20 Q48 12 56 28 Q48 36 32 28 Q16 36 8 28 Q16 12 32 20z"/><circle cx="32" cy="8" r="3" fill="#ffd89c"/></svg></div>'
        };
        return svgs[iconId] || '<span class="back">?</span>';
      }

      function getCookie(name) {
        var parts = ('; ' + document.cookie).split('; ' + name + '=');
        return parts.length === 2 ? decodeURIComponent(parts[1].split(';')[0]) : '';
      }
      function setCookie(name, value, maxAge) {
        document.cookie = name + '=' + encodeURIComponent(value) + '; path=/; max-age=' + (maxAge || 31536000);
      }

      function getLeaderboard() {
        try {
          var raw = getCookie(COOKIE_NAME);
          if (!raw) return [];
          var arr = JSON.parse(raw);
          return Array.isArray(arr) ? arr.slice(0, MAX_LEADERBOARD) : [];
        } catch (e) { return []; }
      }
      function saveLeaderboard(times) {
        times.sort(function(a, b) { return a - b; });
        setCookie(COOKIE_NAME, JSON.stringify(times.slice(0, MAX_LEADERBOARD)));
      }
      function addTime(seconds) {
        var times = getLeaderboard();
        times.push(seconds);
        saveLeaderboard(times);
      }

      var gridEl = document.getElementById('grid');
      var timerEl = document.getElementById('timer');
      var resultOverlay = document.getElementById('resultOverlay');
      var resultTimeEl = document.getElementById('resultTime');
      var leaderboardList = document.getElementById('leaderboardList');
      var playAgainBtn = document.getElementById('playAgainBtn');

      var cards = [];
      var flipped = [];
      var startTime = null;
      var timerId = null;
      var locked = false;

      function shuffle(arr) {
        for (var i = arr.length - 1; i > 0; i--) {
          var j = Math.floor(Math.random() * (i + 1));
          var t = arr[i];
          arr[i] = arr[j];
          arr[j] = t;
        }
        return arr;
      }

      function formatTime(sec) {
        return sec < 60 ? sec.toFixed(1) + 's' : Math.floor(sec / 60) + 'm ' + (sec % 60).toFixed(0) + 's';
      }

      function updateTimer() {
        if (startTime === null) return;
        var sec = (Date.now() - startTime) / 1000;
        timerEl.textContent = 'Time: ' + sec.toFixed(1) + 's';
      }

      function buildGrid() {
        var pairs = ICON_IDS.concat(ICON_IDS);
        shuffle(pairs);
        gridEl.innerHTML = '';
        cards = pairs.map(function(iconId, i) {
          var div = document.createElement('div');
          div.className = 'card';
          div.dataset.index = i;
          div.dataset.iconId = iconId;
          div.innerHTML = '<span class="back">?</span>';
          div.addEventListener('click', function() { onCardClick(i); });
          gridEl.appendChild(div);
          return { iconId: iconId, el: div };
        });
      }

      function onCardClick(index) {
        if (locked) return;
        var card = cards[index];
        if (card.el.classList.contains('flipped') || card.el.classList.contains('matched')) return;

        if (startTime === null) {
          startTime = Date.now();
          timerId = setInterval(updateTimer, 100);
        }

        card.el.classList.add('flipped');
        card.el.innerHTML = getIconHTML(card.iconId, 'g' + index + '_');
        flipped.push(index);

        if (flipped.length === 2) {
          locked = true;
          var a = cards[flipped[0]].iconId;
          var b = cards[flipped[1]].iconId;
          if (a === b) {
            cards[flipped[0]].el.classList.add('matched');
            cards[flipped[1]].el.classList.add('matched');
            flipped = [];
            locked = false;
            var allMatched = cards.every(function(c) { return c.el.classList.contains('matched'); });
            if (allMatched) endGame();
          } else {
            setTimeout(function() {
              cards[flipped[0]].el.classList.remove('flipped');
              cards[flipped[1]].el.classList.remove('flipped');
              cards[flipped[0]].el.innerHTML = '<span class="back">?</span>';
              cards[flipped[1]].el.innerHTML = '<span class="back">?</span>';
              flipped = [];
              locked = false;
            }, 700);
          }
        }
      }

      function endGame() {
        if (timerId) clearInterval(timerId);
        var sec = (Date.now() - startTime) / 1000;
        addTime(sec);
        resultTimeEl.textContent = 'Your time: ' + formatTime(sec);
        var times = getLeaderboard();
        leaderboardList.innerHTML = times.slice(0, MAX_LEADERBOARD).map(function(t, i) {
          return '<li>' + (i + 1) + '. ' + formatTime(t) + '</li>';
        }).join('');
        if (times.length === 0) leaderboardList.innerHTML = '<li>No times yet</li>';
        resultOverlay.classList.add('visible');
      }

      function playAgain() {
        resultOverlay.classList.remove('visible');
        startTime = null;
        if (timerId) clearInterval(timerId);
        timerId = null;
        flipped = [];
        locked = false;
        timerEl.textContent = 'Time: 0.0s';
        buildGrid();
      }

      playAgainBtn.addEventListener('click', playAgain);
      buildGrid();
    })();
  </script>
</body>
</html>
